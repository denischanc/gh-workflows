name: Build with autotools
on:
  workflow_call:
    inputs:
      reconf-file:
        type: string
        default: ./bin/reconf.sh
      packages-to-install:
        type: string
env:
  BUILD_DIR: _build
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - if: inputs.packages-to-install != ''
      env:
        PACKAGES: ${{ inputs.packages-to-install }}
      run: sudo apt update && sudo apt install -y $PACKAGES
    - uses: actions/checkout@v6
    - run: ${{ inputs.reconf-file }}
    - run: mkdir -p $BUILD_DIR
    - working-directory: ${{ env.BUILD_DIR }}
      run: $GITHUB_WORKSPACE/configure && make check
